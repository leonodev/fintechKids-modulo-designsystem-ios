name: iOS Design System CI

on:
  pull_request:
    branches: [develop]
  push:
    branches: [develop]

jobs:
  test:
    runs-on: macos-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: '16.4'
    
    - name: Create symbolic link to fix path issue
      run: |
        echo "=== CREANDO ENLACE SIMBÓLICO PARA SOLUCIONAR RUTA ==="
        
        # El proyecto busca en /Users/runner/work/fintechKids-modulo-designsystem-ios/FHKDesignSystem
        # Pero el paquete está en /Users/runner/work/fintechKids-modulo-designsystem-ios/fintechKids-modulo-designsystem-ios/
        
        # Crear el directorio que Xcode espera
        mkdir -p /Users/runner/work/fintechKids-modulo-designsystem-ios
        
        # Crear enlace simbólico al repositorio actual
        ln -sf "$(pwd)" /Users/runner/work/fintechKids-modulo-designsystem-ios/FHKDesignSystem
        
        echo "✅ Enlace simbólico creado"
        echo "Ruta real: $(pwd)"
        echo "Enlace: /Users/runner/work/fintechKids-modulo-designsystem-ios/FHKDesignSystem"
    
    - name: Test Demo App
      working-directory: ./Demo/FHKDesignSystemDemo
      run: |
        echo "=== EJECUTANDO TESTS ==="
        
        # Ahora debería funcionar
        xcodebuild test \
          -project FHKDesignSystemDemo.xcodeproj \
          -scheme FHKDesignSystemDemo \
          -destination 'platform=iOS Simulator,name=iPhone 15' \
          CODE_SIGNING_ALLOWED=NO
        
        echo "✅ Tests completados"
