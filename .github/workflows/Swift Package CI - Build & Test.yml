name: CI Build and Test - Final Stable

on:
push:
branches: [ develop ]
pull_request:
branches: [ develop ]
workflow_dispatch:

jobs:
build-and-test:
name: Build and Test FHKDesignSystem

# macos-14 usa runners de Apple Silicon (ARM64)
runs-on: macos-14

steps:
  - name: Checkout Repository
    uses: actions/checkout@v4
    
  # 1. Seleccionar Xcode 16.2
  - name: Select Xcode 16.2
    uses: maxim-lobanov/setup-xcode@v1
    with:
      xcode-version: '16.2'
      
  # 2. Configurar el Toolchain de Swift 6.2
  - name: Setup Swift 6.2 Toolchain
    uses: swift-actions/setup-swift@v2
    with:
      swift-version: '6.2'
      
  # 3. ðŸš€ Ejecutar las Pruebas Unitarias (Usando xcodebuild para SPM)
  # Nota: Usamos 'xcodebuild' en lugar de 'swift test' para tener control total sobre
  # las flags de Code Signing, crucial en entornos CI/CD para targets iOS/Simulador.
  - name: Run Unit Tests with Code Signing Fix
    run: |
      # El nombre del esquema para un Swift Package es, por defecto, el nombre del paquete.
      # Usamos un destino de simulador de iOS con la arquitectura ARM64 (propia de macos-14).
      xcodebuild test \
        -scheme FHKDesignSystem \
        -destination 'platform=iOS Simulator,arch=arm64,name=iPhone 15' \
        -configuration Debug \
        -enableCodeCoverage YES \
        # Deshabilitamos explÃ­citamente la firma de cÃ³digo
        CODE_SIGN_IDENTITY="" \
        CODE_SIGNING_REQUIRED=NO
